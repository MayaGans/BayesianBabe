---
title: Why Would I setTimeout(0)?
author: Maya Gans
date: '2019-07-01'
slug: why-would-i-settimeout-0
categories:
  - Tutorial
tags:
  - JavaScript
subtitle: ''
summary: ''
authors: []
lastmod: '2019-07-01T19:14:20-06:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<iframe src="../../../files/button.html" height="143px" width="450 px" align="center">
</iframe>
<p><br></br></p>
<p>Along with the hands-on skills I’ve been learning during my internship with RStudio, I’ve also been bolstering my theoretical understandings of programming concepts. This brought me to a common trick <code>setTimeout(0)</code>, which defers the execution of a function, giving something else a chance to run.</p>
<p>This concept was described using a concrete example in a <a href="https://stackoverflow.com/questions/779379/why-is-settimeoutfn-0-sometimes-useful">StackOverflow post</a> that I wanted to explore visually:</p>
<div class="figure">
<img src="img1.png" />

</div>
<p>You want to create a button on your website with two tasks (1) perform a long calculation (2) and to print “Calculating…” in a div until “Done!” can be printed.</p>
<div id="create-button-in-html" class="section level1">
<h1>CREATE BUTTON IN HTML</h1>
<p>First we’ll create two buttons with small divs to see the status of the calculation</p>
<pre class="html"><code>&lt;table border=1&gt;
  // our &#39;do&#39; button will not use setTimeout
  &lt;tr&gt;&lt;td&gt;&lt;button id=&#39;do&#39;&gt;Do long calc - No Time Out&lt;/button&gt;&lt;/td&gt;
  // the default value in the div is &#39;Not Calculating yet&#39;
      &lt;td&gt;&lt;div id=&#39;status&#39;&gt;Not Calculating yet.&lt;/div&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;button id=&#39;do_ok&#39;&gt;Do long calc - Set Time Out 0&lt;/button&gt;&lt;/td&gt;
      &lt;td&gt;&lt;div id=&#39;status_ok&#39;&gt;Not Calculating yet.&lt;/div&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</code></pre>
<div class="figure">
<img src="img3.png" />

</div>
</div>
<div id="create-long-function" class="section level1">
<h1>CREATE LONG FUNCTION</h1>
<p>Create a function that takes a “long time” to run. When the function is done, it prints “Done!” to the div</p>
<pre class="js"><code>function long_running(status_div) {
    var result = 0;
    for (var i = 0; i &lt; 1000; i++) {
        for (var j = 0; j &lt; 700; j++) {
            for (var k = 0; k &lt; 300; k++) {
                result = result + i + j + k;
            }
        }
    }
    document.getElementById(&#39;status&#39;).innerHTML = &quot;Done!&quot;;
}</code></pre>
<script type="text/javascript">
function long_running(status_div) {
    var result = 0;
    for (var i = 0; i < 1000; i++) {
        for (var j = 0; j < 700; j++) {
            for (var k = 0; k < 300; k++) {
                result = result + i + j + k;
            }
        }
    }
    document.getElementById('status').innerHTML = "Done!";
}
</script>
</div>
<div id="create-status-update-function" class="section level1">
<h1>CREATE STATUS UPDATE FUNCTION</h1>
<pre class="js"><code>function status_update(status_div) {
  document.getElementById(&#39;status&#39;).innerHTML = &quot;calculating...&quot;;
}</code></pre>
<script type="text/javascript">
function status_update(status_div) {
  document.getElementById('status').innerHTML = "calculating...";
}
</script>
</div>
<div id="put-it-all-together" class="section level1">
<h1>PUT IT ALL TOGETHER</h1>
<p>Update the div by using an Event Listener. When clicking the button run our long calculation and the status update.</p>
<pre class="js"><code>document.getElementById(&#39;do&#39;).addEventListener(&#39;click&#39;, long_running, status_update);</code></pre>
<script type="text/javascript">
document.getElementById('do').addEventListener('click', long_running, status_update);
</script>
</div>
<div id="fail" class="section level1">
<h1>FAIL</h1>
<p>Without using <code>setTimeout(0)</code> the queue of tasks that the button fires off are done serially: the calculations are performed and then “Done!” is printed. The button text “Not calculating yet” changes to “Done” BEFORE it ever had the chance to run the <code>status_update</code> function and change to “calculating….”</p>
<div class="figure">
<img src="img2.png" />

</div>
<p>Using <code>setTimeout(0)</code> is a nifty trick to defer the actual long calculations until <code>status_update</code> has been executed. By setting a timeout if 0, you are queuing asynchronous code until the engine executes the current call stack.</p>
<pre class="js"><code>document.getElementById(&#39;do_ok&#39;).addEventListener(&quot;click&quot;, function(){
    setTimeout(function(){
        long_running2();
    }, 0);
    status_update2()
});</code></pre>
<script type="text/javascript">
document.getElementById('do_ok').addEventListener("click", function(){
    setTimeout(function(){
        long_running2();
    }, 0);
    status_update2()
});
</script>
<p><strong>In the code chunk above the button text “Not calculating yet” will change to “Calculating….” and THEN “Done!”</strong></p>
</div>
<div id="conclusion" class="section level1">
<h1>CONCLUSION</h1>
<p>JavaScript runtimes contain a message queue to store the list of messages to be processed (here “calculating…”). Because JavaScript is non-blocking, the messages can be queued in response to events (here: the long calculation). Using a simple <strong>event loop</strong> within our button, JavaScript enables the collection of ascynchronous callbacks freeing the runtime to handle concurrent operations.</p>
</div>
