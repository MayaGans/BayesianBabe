---
title: Introduction to Networks
author: Maya Gans
date: '2020-03-09'
slug: introduction-to-networks
categories:
  - Tutorial
tags:
  - Network Science
  - d3.js
subtitle: ''
summary: ''
authors: []
lastmod: '2020-03-09T12:35:23-07:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



  <meta charset='utf-8' />
  <meta http-equiv='X-UA-Compatible' content='IE=edge' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/scrollama/2.2.0/scrollama.js'></script>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css'
    integrity='sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq' crossorigin='anonymous'>
  <script defer src='https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js'
    integrity='sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz'
    crossorigin='anonymous'></script>
  <script defer src='https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js'
    integrity='sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI' crossorigin='anonymous'
    onload='renderMathInElement(document.body);'></script>
  <meta name='viewport' content='width=device-width, initial-scale=1' />

  <style>
  table, caption, tbody, tfoot, thead, tr, th, td {
    padding: 3px;
    border: 0;
    outline: 0;
    font-size: 6px;
    background: transparent;
    color: black;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
}

    .node circle {
      stroke: black;
      stroke-width: 2px;
      color: black;
    }

    .node text {
      font-family: sans-serif;
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
    }

    .link {
      stroke-width: 4px;
    }


    text {
      font: 18px sans-serif;
      pointer-events: none;
    }

    #end-arrow {
      fill: #88A;
    }

    #scrolly {
      position: relative;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      padding: 1rem;
    }

    #scrolly>* {
      -webkit-box-flex: 1;
      -ms-flex: 1;
      flex: 1;
    }

    figure {
      position: -webkit-sticky;
      position: sticky;
      width: 100%;
      margin: 0;
      -webkit-transform: translate3d(0, 0, 0);
      -moz-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
      z-index: 0;
    }

    figure p {
      text-align: center;
      padding: 1rem;
      position: absolute;
      top: 50%;
      left: 50%;
      -moz-transform: translate(-50%, -50%);
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      font-size: 8rem;
      font-weight: 900;
    }

    .step {
      margin: 0 auto 2rem auto;
      color: #C0C0C0;
    }

    .step:last-child {
      margin-bottom: 0;
    }

    .step.is-active {
      color: #3b3b3b;
    }

    .step p {
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      line-height: 90%;
    }

    body {
      font-size: 10px;
      font-family: 'Open Sans', sans-serif;
      font-weight: 400;
      text-align: center;
    }

    h1 {
      font-size: 50px;
    }
    
    table>thead>tr>th, 
    table>tbody>tr>th, 
    table>tfoot>tr>th, 
    table>thead>tr>td, 
    table>tbody>tr>td, 
    table>tfoot>tr>td { 
      background-color: transparent;
      border-top: transparent;
      color: black;
      padding: 3px;
    }
    
    table>tbody>tr:nth-child(odd)>td, table>tbody>tr:nth-child(odd)>th {
      background-color: transparent;
      color: black;
    }
    
    th {
      color: black;
      padding: 3px;
    }
    
    td {
      color: black;
      padding: 3px;
    }
  </style>

  <main>

    <section id='scrolly'>
      <article>
        <div class='step' data-step='1'>
          <p>This is a graph</p>
        </div>
        <div class='step' data-step='2'>
          <p>Node <font color='#EE5A63'>B</font> is a pivotal node.</p>
          <p>
            <font size='3'>It provides the shortest path to get from <font color='white'>A</font>  to 
            <font color='white'>C</font>  and <font color='white'>A</font>  to <font color='white'>D</font>. </font>
          </p>
        </div>
        <div class='step' data-step='3'>
          <p>Pivotal is Relative.</p>
          <p>
            <font size='3'>Node<font color='#EE5A63'> B</font> is NOT pivotal for <font color='#5ba860'>D</font> and <font
                color='#5ba860'>F</font> because because there is
              another shortest path they can take.</font>
          </p>
        </div>
        <div class='step' data-step='4'>
          <p>Some Nodes are Never Pivotal.</p>
          <p>
            <font size='3'>Also note <font color='#EE5A63'>D</font> is not pivatol for any pairs. </font>
          </p>
        </div>
        <div class='step' data-step='5'>
          <p>Here's Another Graph.</p>
        </div>
        <div class='step' data-step='6'>
          <p>Gatekeeper</p>
          <font size='3'>Node <font color='#EE5A63'>A</font> 
          is a gatekeeper because it lies on every path from <font color='#5ba860'>E</font> to <font color='#5ba860'>B</font>.</font>
        </div>
        <div class='step' data-step='7'>
          <p>Gatekeeper is Relative to Scale.</p>
          <p>
            <font size='3'>Node <font color='#EE5A63'>B</font> is a local gatekeeper because it connects nodes 
            <font color='#5ba860'>C</font> and <font color='#5ba860'>D</font></font>
          </p>
        </div>
        <div class='step' data-step='8'>
          <p>
            <font size='3'>But <font color='#5ba860'>B</font> 
            is not a global gatekeeper because <font color='#EE5A63'>C</font> and <font color='#EE5A63'>D</font> 
            can also be connected through <font color='#EE5A63'>A</font>.
            </font>
          </p>
        </div>
        <div class='step' data-step='9'>
          <p>One More Graph<p>
        </div>
        <div class='step' data-step='10'>
          <p>Graph Length</p>
          <p>
            <font size='3'>The number of edges within the entire graph
            </font>
          </p>
        </div>
        <div class='step' data-step='11'>
          <p>Graph Distance</p>

          <p>
            <font size='2'>The distance between two vertices in a graph is the number of edges in their shortest path. 
              The matrix shows the minimum distance between every node
            </font>
          </p>

          <table>
            <tr>
              <td></td>
              <td>A</td>
              <td>B</td>
              <td>C</td>
              <td>F</td>
              <td>G</td>
              <td>E</td>
              <td>D</td>
            </tr>
            <tr>
              <td>A</td>
              <td>0</td>
              <td>1</td>
              <td>1</td>
              <td>1</td>
              <td>2</td>
              <td>1</td>
              <td>2</td>
            </tr>
            <tr>
              <td>B</td>
              <td>1</td>
              <td>0</td>
              <td>1</td>
              <td>2</td>
              <td>3</td>
              <td>2</td>
              <td>3</td>
            </tr>
            <tr>
              <td>C</td>
              <td>1</td>
              <td>1</td>
              <td>0</td>
              <td>1</td>
              <td>3</td>
              <td>2</td>
              <td>3</td>
            </tr>
            <tr>
              <td>F</td>
              <td>1</td>
              <td>2</td>
              <td>1</td>
              <td>0</td>
              <td>2</td>
              <td>1</td>
              <td>2</td>
            </tr>
            <tr>
              <td>G</td>
              <td>2</td>
              <td>3</td>
              <td>3</td>
              <td>2</td>
              <td>0</td>
              <td>1</td>
              <td>2</td>
            </tr>
            <tr>
              <td>E</td>
              <td>1</td>
              <td>2</td>
              <td>2</td>
              <td>1</td>
              <td>1</td>
              <td>0</td>
              <td>1</td>
            </tr>
            <tr>
              <td>D</td>
              <td>2</td>
              <td>3</td>
              <td>3</td>
              <td>2</td>
              <td>2</td>
              <td>1</td>
              <td>0</td>
            </tr>
          </table>

        </div>
        <div class='step' data-step='12'>
          <p>Eccentricity</p>

          <p>
            <font size='2'>
              Let's look at Node <font color='#EE5A63'>A</font>, the first row in our matrix.
            </font>
          </p>

          <p>
            <font size='2'>
              The path from <font color='#EE5A63'>A</font> to 
              <font color='#EE5A63'>B</font>,
              <font color='#EE5A63'>C</font>, 
              <font color='#EE5A63'>F</font>, & 
              <font color='#EE5A63'>E</font> is 1, and to 
              <font color='#5ba860'>G</font> or 
              <font color='#5ba860'>D</font> is 
              2.
            </font>
          </p>

          <p>
            <font size='2'>
              The highest shortest path length of <font color='#EE5A63'>A</font> [its eccentricitiy] is 2.
            </font>
          </p>

        </div>

        <div class='step' data-step='13'>
          <p>Diameter</p>
          <p>
            <font size='3'>
              While eccentricity is a metric we can apply to every node, the graph's diameter is the <font color='#EE5A63'>maximum</font> overall
              distance of every pair of nodes in the graph.
            </font>
          </p>
        </div>

        <div class='step' data-step='14'>
          <p>Radius: Periheral</p>
          <p>
            <font size='2'>
              The radius is the minimum eccentricity of the graph.
            </font>
          </p>

          <p>
            <font size='2'>
              Any vertex whose eccentricity is equal to the graph's diameter is <font color='#EE5A63'>peripheral</font>.
            </font>
          </p>
        </div>

        <div class='step' data-step='15'>
          <p>Radius: Central</p>
          <p>
            <font size='3'>
              If the eccentricity of a node is equal to the graphs radius then it is a <font color='#EE5A63'>central</font> vertex
            </font>
          </p>
        </div>

      </article>

      <figure></figure>

    </section>

    <section id='outro'>
      <font size='2'>
        <p>As we can see here, the radius of a graph is always less than the diameter which always less
          than 2 times the diameter of the graph.</p>

        <p>$$\text{rad}(G) \leq \text{diam}(G) \leq 2 \text{ rad}(G) $$</p>

        <p>The first inequality, that the minimum eccentricities (2) is smaller than the maximum eccentricities
          (3) is logical.

          <p>We can prove the second inequality by looking at 2 peripheral nodes, G and B,
            and one central node, A.</p>

          <p>We know the diameter is the distance from G to B.</p>

          <p>We also know that distance is bounded by the distance from G to A (at most A's accentricity = 2) and A to B
            (at most A's accentricity = 2).</p>

          <p>We also know A's accentricity is the radius because it is a central node. Therefore: </p>

          <p>$$d(u,v) \leq 2*rad(G)$$</p>
      </font>
    </section>

  </main>


  <script>
    // I figured this could be a good way to organize the data 
    // when reponse.index < 4 use all_links[0] otherwise use all_links[1]

    // use color + response.index to color the links

    // using d3 for convenience
    var main = d3.select('main');
    var scrolly = main.select('#scrolly');
    var figure = scrolly.select('figure');
    var article = scrolly.select('article');
    var step = article.selectAll('.step');

    margin = {
      top: 30,
      right: 80,
      bottom: 30,
      left: 30
    }

    width = 590
    height = 340

    var simulation = d3.forceSimulation()
      .force('link', d3.forceLink().id(function (d) { return d.id; }))
      //.force('charge', d3.forceManyBody().strength(-200))
      .force('charge', d3.forceManyBody()
        .strength(-1000)
        .distanceMax(200)
      )
      .force('center', d3.forceCenter(width / 2, height / 2));

    var svg = figure.append('svg').attr('height', 600).attr('width', 600)


    const dataset = {
      nodes: [
        // graph 1 and 2
        { name: "A", id: 0, color0: 'white', color1: 'white', color2: 'white', color3: 'white', color4: 'white', color5: '#EE5A63', color6: 'white', color7: '#EE5A63', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: 'white', color14: '#EE5A63' },
        { name: "B", id: 1, color0: 'white', color1: '#EE5A63', color2: '#EE5A63', color3: 'white', color4: 'white', color5: '#5ba860', color6: '#EE5A63', color7: '#5ba860', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: '#EE5A63', color14: 'white' },
        { name: "C", id: 2, color0: 'white', color1: 'white', color2: 'white', color3: 'white', color4: 'white', color5: 'white', color6: '#5ba860', color7: '#EE5A63', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: '#EE5A63', color14: 'white' },
        { name: "D", id: 3, color0: 'white', color1: 'white', color2: '#5ba860', color3: '#EE5A63', color4: 'white', color5: 'white', color6: '#5ba860', color7: '#EE5A63', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: '#EE5A63', color14: 'white' },
        { name: "E", id: 4, color0: 'white', color1: 'white', color2: 'white', color3: 'white', color4: 'white', color5: '#5ba860', color6: 'white', color7: 'white', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: 'white', color14: '#EE5A63' },
        { name: "F", id: 5, color0: 'white', color1: 'white', color2: '#5ba860', color3: 'white', color4: 'white', color5: 'white', color6: 'white', color7: 'white', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: 'white', color14: '#EE5A63' },
        { name: "G", id: 6, color0: 'white', color1: 'white', color2: 'white', color3: 'white', color4: 'white', color5: 'white', color6: 'white', color7: 'white', color8: 'white', color9: 'white', color10: 'white', color11: 'white', color12: 'white', color13: '#EE5A63', color14: 'white' }
      ],
      links: [
        // graph 1
        { id: 1, source: 0, target: 1, color0: 'white', color1: '#EE5A63', color2: 'white', color3: 'white', type: ''},
        { id: 2, source: 0, target: 5, color0: 'white', color1: 'white', color2: 'white', color3: 'white', type: '' },
        { id: 3, source: 5, target: 4, color0: 'white', color1: 'white', color2: '#5ba860', color3: 'white', type: '' },
        { id: 4, source: 4, target: 2, color0: 'white', color1: 'white', color2: '#5ba860', color3: 'white', type: '' },
        { id: 5, source: 2, target: 1, color0: 'white', color1: '#EE5A63', color2: 'white', color3: 'white', type: '' },
        { id: 6, source: 3, target: 1, color0: 'white', color1: '#EE5A63', color2: 'white', color3: 'white', type: '' },
        { id: 7, source: 3, target: 2, color0: 'white', color1: 'white', color2: '#5ba860', color3: 'white', type: '' },
        // graph 2
        { id: 8, source: 0, target: 1, color4: 'white', color5: '#5ba860', color6: 'white', color7: 'white', type: '' },
        { id: 9, source: 0, target: 4, color4: 'white', color5: '#5ba860', color6: 'white', color7: 'white', type: '' },
        { id: 10, source: 4, target: 5, color4: 'white', color5: 'white', color6: 'white', color7: 'white', type: '' },
        { id: 11, source: 0, target: 5, color4: 'white', color5: 'white', color6: 'white', color7: 'white', type: '' },
        { id: 12, source: 0, target: 2, color4: 'white', color5: 'white', color6: 'white', color7: '#EE5A63', type: '' },
        { id: 13, source: 2, target: 1, color4: 'white', color5: 'white', color6: '#5ba860', color7: 'white', type: '' },
        { id: 14, source: 3, target: 1, color4: 'white', color5: 'white', color6: '#5ba860', color7: 'white', type: '' },
        { id: 15, source: 0, target: 3, color4: 'white', color5: 'white', color6: 'white', color7: '#EE5A63', type: '' },
        
        // graph 3-8
        { id: 17, source: 0, target: 1, color8: 'white', color10: 'white', type: ''},
        { id: 18, source: 0, target: 2, color8: 'white', color10: 'white', type: ''},
        { id: 19, source: 0, target: 4, color8: 'white', color10: 'white', type: ''},
        { id: 20, source: 0, target: 5, color8: 'white', color10: 'white', type: ''},
        { id: 21, source: 1, target: 2, color8: 'white', color10: 'white', type: ''},
        { id: 22, source: 2, target: 5, color8: 'white', color10: 'white', type: ''},
        { id: 23, source: 4, target: 5, color8: 'white', color10: 'white', type: ''},
        { id: 24, source: 4, target: 3, color8: 'white', color10: 'white', type: ''},
        { id: 25, source: 4, target: 6, color8: 'white', color10: 'white', type: ''},

        // graph 3-9
        { id: 26, source: 0, target: 1, color9: 'white', type: '1'},
        { id: 27, source: 0, target: 2, color9: 'white', type: '2'},
        { id: 28, source: 0, target: 4, color9: 'white', type: '3'},
        { id: 29, source: 0, target: 5, color9: 'white', type: '4'},
        { id: 30, source: 1, target: 2, color9: 'white', type: '5'},
        { id: 31, source: 2, target: 5, color9: 'white', type: '6'},
        { id: 32, source: 4, target: 5, color9: 'white', type: '7'},
        { id: 33, source: 4, target: 3, color9: 'white', type: '8'},
        { id: 34, source: 4, target: 6, color9: 'white', type: '9'},

        // graph 3-10
        { id: 53, source: 0, target: 1, color10: 'white', type: ''},
        { id: 54, source: 0, target: 2, color10: 'white', type: ''},
        { id: 55, source: 0, target: 4, color10: 'white', type: ''},
        { id: 56, source: 0, target: 5, color10: 'white', type: ''},
        { id: 57, source: 1, target: 2, color10: 'white', type: ''},
        { id: 58, source: 2, target: 5, color10: 'white', type: ''},
        { id: 59, source: 4, target: 5, color10: 'white', type: ''},
        { id: 60, source: 4, target: 3, color10: 'white', type: ''},
        { id: 61, source: 4, target: 6, color10: 'white', type: ''},

        // graph 3-11
        { id: 35, source: 0, target: 1, color11: '#EE5A63',  type: '1'},
        { id: 36, source: 0, target: 2, color11: '#EE5A63',  type: '1'},
        { id: 37, source: 0, target: 4, color11: '#EE5A63',  type: '1'},
        { id: 38, source: 0, target: 5, color11: '#EE5A63',  type: '1'},
        { id: 39, source: 1, target: 2, color11: 'white', type: ''},
        { id: 40, source: 2, target: 5, color11: 'white', type: ''},
        { id: 41, source: 4, target: 5, color11: 'white', type: ''},
        { id: 42, source: 4, target: 3, color11: '#5ba860', type: '2'},
        { id: 43, source: 4, target: 6, color11: '#5ba860', type: '2'},

        // graph 3-11
        { id: 44, source: 0, target: 1, color12: '#EE5A63', color13: 'white', color14: 'white', type: ''},
        { id: 45, source: 0, target: 2, color12: 'white', color13: 'white', color14: 'white', type: ''},
        { id: 46, source: 0, target: 4, color12: '#EE5A63', color13: 'white', color14: 'white', type: ''},
        { id: 47, source: 0, target: 5, color12: 'white', color13: 'white', color14: 'white', type: ''},
        { id: 48, source: 1, target: 2, color12: 'white', color13: 'white', color14: 'white', type: ''},
        { id: 49, source: 2, target: 5, color12: 'white', color13: 'white', color14: 'white', type: ''},
        { id: 50, source: 4, target: 5, color12: 'white', color13: 'white', color14: 'white', type: ''},
        { id: 51, source: 4, target: 3, color12: '#EE5A63', color13: 'white', color14: 'white', type: ''},
        { id: 52, source: 4, target: 6, color12: 'white', color13: 'white', color14: 'white', type: ''},
      ]
    };


    console.log('dataset is ...', dataset);

    // Initialize the links
    let link = svg.append('g')
      .attr('class', 'links')
      .selectAll('line');

    // Initialize the nodes
    let node = svg.append('g')
      .attr('class', 'nodes')
      .selectAll('circle');
    // .enter().append('circle')

    // Text to nodes
    let text = svg.append('g')
      .attr('class', 'text')
      .selectAll('text')

    // Edge paths for the labels
    let edgepaths = svg.append("g")
      .selectAll(".links-path");

    // Labels for edges
    let edgelabels = svg.append("g")
      .selectAll(".links-text");

    //Listen for tick events to render the nodes as they update in your Canvas or SVG.
    simulation
      .nodes(dataset.nodes)//sets the simulation’s nodes to the specified array of objects, initializing their positions and velocities, and then re-initializes any bound forces;
      .on('tick', ticked);//use simulation.on to listen for tick events as the simulation runs.
    // After this, Each node must be an object. The following properties are assigned by the simulation:
    // index - the node’s zero-based index into nodes
    // x - the node’s current x-position
    // y - the node’s current y-position
    // vx - the node’s current x-velocity
    // vy - the node’s current y-velocity

    simulation.force('link')
      .links(dataset.links);//sets the array of links associated with this force, recomputes the distance and strength parameters for each link, and returns this force.
    // After this, Each link is an object with the following properties:
    // source - the link’s source node; 
    // target - the link’s target node; 
    // index - the zero-based index into links, assigned by this method


    // This function is run at each iteration of the force algorithm, updating the nodes position (the nodes data array is directly manipulated).
    function ticked() {
      link.attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);

      node.attr('cx', d => d.x)
        .attr('cy', d => d.y);

      text.attr('x', d => d.x - 5) //position of the lower left point of the text
        .attr('y', d => d.y + 5); //position of the lower left point of the text

      edgepaths.attr('d', function (d) {
        var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y;
        //console.log(d)
        return path
      });

      edgelabels.attr('transform', function (d, i) {
        if (d.target.x < d.source.x) {
          let bbox = this.getBBox();
          let rx = bbox.x + bbox.width / 2;
          let ry = bbox.y + bbox.height / 2;
          return 'rotate(180 ' + rx + ' ' + ry + ')';
        }
        else {
          return 'rotate(0)';
        }
      });
    }

    //When the drag gesture starts, the targeted node is fixed to the pointer
    //The simulation is temporarily “heated” during interaction by setting the target alpha to a non-zero value.
    function dragstarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();//sets the current target alpha to the specified number in the range [0,1].
      d.fy = d.y; //fx - the node’s fixed x-position. Original is null.
      d.fx = d.x; //fy - the node’s fixed y-position. Original is null.
    }

    //When the drag gesture starts, the targeted node is fixed to the pointer
    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    //the targeted node is released when the gesture ends
    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;

      console.log('dataset after dragged is ...', dataset);
    }


    //////////////////////////////////////////////////////////////
    /// Scrollytelling: Update node color and links
    //////////////////////////////////////////////////////////////


    // initialize the scrollama
    var scroller = scrollama();

    // generic window resize listener event
    function handleResize() {
      // 1. update height of step elements
      var stepH = Math.floor(window.innerHeight * 0.75);
      step.style('height', stepH + 'px');

      var figureHeight = window.innerHeight / 2;
      var figureMarginTop = (window.innerHeight - figureHeight) / 2;

      figure
        .style('height', figureHeight + 'px')
        .style('top', figureMarginTop + 'px')

      // 3. tell scrollama to update new element dimensions
      scroller.resize();
    }

    // scrollama event handlers
    function handleStepEnter(response) {

      // response = { element, direction, index }
      // add color to current step only
      step.classed('is-active', function (d, i) {
        return i === response.index;
      });

      console.log(response.index)

      colors = 'd.color' + response.index
      edge_text = 'd.type' + response.index

      // if you're at the first graph, don't use the last node [A-F]
      // and only use the first 8 edges [this works]
      if (response.index < 4) {
        nodes = dataset.nodes.filter(function (d) { return d.id < 6 })
        links = dataset.links.filter(function (d) { return d.id < 8 });
        restart()
        // if you're at graph 2 
        // use nodes A-F and links 8-16
      } else if (response.index > 3 && response.index < 8) {
        nodes = dataset.nodes.filter(function (d) { return d.id < 6 });
        links = dataset.links.filter(function (d) { return d.id >= 8 & d.id <= 16 });
        restart()
      } else if (response.index === 8) {
        // if you're at graph 3 with labels (9)
        nodes = dataset.nodes.filter(function (d) { return d.id < 8 });
        links = dataset.links.filter(function (d) { return d.id >= 17 & d.id <= 25 });
        restart();
      } else if (response.index === 9) {
        // if you're at graph 3 with labels (9)
        nodes = dataset.nodes.filter(function (d) { return d.id < 8 });
        links = dataset.links.filter(function (d) { return d.id >= 26 & d.id <= 34 });
        restart();
      } else if (response.index === 10) {
        // if you're at graph 3 with labels (9)
        nodes = dataset.nodes.filter(function (d) { return d.id < 8 });
        links = dataset.links.filter(function (d) { return d.id >= 53 & d.id <= 61 });
        restart();
      } else if (response.index === 11) {
        // if you're at graph 3 with labels (10)
        nodes = dataset.nodes.filter(function (d) { return d.id < 8 });
        links = dataset.links.filter(function (d) { return d.id >= 35 & d.id <= 43 });
        restart();
      } else {
        // if you're at graph 3 use node G and the last edges
        nodes = dataset.nodes.filter(function (d) { return d.id < 8 });
        links = dataset.links.filter(function (d) { return d.id >= 44 });
        restart();
      }

      node.attr('fill', function (d) { return eval(colors) })
      link.style('stroke', function (d) { return eval(colors) })


    }

    function setupStickyfill() {
      d3.selectAll('.sticky').each(function () {
        Stickyfill.add(this);
      });
    }

    function init() {
      setupStickyfill();

      // 1. force a resize on load to ensure proper dimensions are sent to scrollama
      handleResize();

      // 2. setup the scroller passing options
      // 	   this will also initialize trigger observations
      // 3. bind scrollama event handlers (this can be chained like below)
      scroller
        .setup({
          step: '#scrolly article .step',
          offset: 0.5,
          debug: false
        })
        .onStepEnter(handleStepEnter);

      // setup resize event
      window.addEventListener('resize', handleResize);
    }

    // kick things off
    init();

    function restart() {
      if (simulation) simulation.stop();

      // Apply the general update pattern to the nodes.
      node = node.data(nodes);
      node.exit().remove();

      node = node.enter().append('circle')
        .attr('r', 15)
        .style('stroke', '#777')
        .style('stroke-width', 2)
        .merge(node)
        .call(d3.drag()  //sets the event listener for the specified typenames and returns the drag behavior.
          .on('start', dragstarted) //start - after a new pointer becomes active (on mousedown or touchstart).
          .on('drag', dragged)      //drag - after an active pointer moves (on mousemove or touchmove).
          .on('end', dragended)     //end - after an active pointer becomes inactive (on mouseup, touchend or touchcancel).
        )

      // Apply the general update pattern to the links.
      link = link.data(links, d => d.id);
      link.exit().remove();
      link = link.enter().append('line')
        .style('stroke-width', 4)
        .merge(link);

      text = text.data(nodes)
      text.exit().remove();
      text = text.enter().append('text').text(function (d) { return d.name; }).merge(text)

      edgepaths = edgepaths.data(links, d => d.source + "-" + d.target);
      edgepaths.exit().remove();
      edgepaths = edgepaths.enter().append('path')
        .attr('class', 'links-path')
        .attr('fill-opacity', 0)
        .attr('stroke-opacity', 0)
        .attr('d', function (d) { return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y })
        .attr('id', function (d, i) { return 'edgepath' + d.source.id + "-" + d.target.id })
        .merge(edgepaths);

      // if I rewrite this as
      // edgelabels = edgelabels.data(links)
      // and put the svg.selectAll portion as a let statement outside of this function
      // it doesn't work at all? 
      edgelabels = edgelabels.data(links, d => d.id);
      edgelabels.exit().remove();
      edgelabels = edgelabels.enter().append('text')
        .attr('class', 'links-text')
        .attr('dx', 40)
        .attr('dy', 5)
        .attr('font-size', 3)
        .attr('fill', 'black')
        .merge(edgelabels);

      edgelabels.append('textPath')
        .attr('xlink:href', d => {
          return "#edgepath" + d.source.id + "-" + d.target.id;
        })
        .text(function (d) { return d.type }).merge(edgelabels);

      // Update and restart the simulation.
      simulation.nodes(nodes);
      simulation.force("link").links(links);
      simulation.alphaTarget(.1); // "Reheat the simulation"
      simulation.restart();
    }

  </script>

